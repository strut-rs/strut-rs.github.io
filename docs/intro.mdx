---
sidebar_position: 2
slug: /
---

# Intro

[rust]: https://www.rust-lang.org/
[cargo-book]: https://doc.rust-lang.org/cargo/
[cargo-book-features]: https://doc.rust-lang.org/cargo/reference/features.html
[externalized-config]: https://www.12factor.net/config
[async-runtime]: https://rust-lang.github.io/async-book/08_ecosystem/00_chapter.html
[crates-io-strut]: https://crates.io/crates/strut
[crates-io-config]: https://crates.io/crates/config
[crates-io-tokio]: https://crates.io/crates/tokio
[crates-io-smol]: https://crates.io/crates/smol
[crates-io-serde]: https://crates.io/crates/serde
[crates-io-dotenvy]: https://crates.io/crates/dotenvy
[crates-io-parking-lot]: https://crates.io/crates/parking_lot

## What is Strut?

:::note
This documentation assumes basic understanding of the [_Rust_][rust] programming language and [_Cargo_][cargo-book], the Rust package manager.
If you are completely new, follow the links to learn about these wonderful tools.
:::

Strut is primarily the [`strut`][crates-io-strut] crate.
It’s main job is to simplify common backend chores:

- Startup:
    - Load [externalized configuration][externalized-config].
    - Build [asynchronous runtime][async-runtime].
    - Initialize logging/tracing.
    - Set up integrations with external systems.
- Spindown:
    - Release held resources.
    - Close external connections.

### What’s included by default

The `strut` crate has many [feature flags][cargo-book-features], but none of them are enabled by default.
At the baseline, these well-known crates are always pulled in by Strut (along with their transitive dependencies, of course):

- [`config`][crates-io-config]: to load the application config from files & environment.
- [`tokio`][crates-io-tokio]: to build the asynchronous runtime for the application.
- [`serde`][crates-io-serde]: to conveniently deserialize the external config.
- [`dotenvy`][crates-io-dotenvy]: to support environment defaults from `.env` files.
- [`parking_lot`][crates-io-parking-lot]: for performant locks (implementation detail).

:::info[Tokio?]
Yes, Strut requires an asynchronous runtime, and makes an opinionated choice for [Tokio][crates-io-tokio].
This comes from the fact that almost all Strut components have some sort of `async` play in them.

No, there is no option to switch to alternatives such as [`smol`][crates-io-smol].
Tokio is a robust, well-maintained, and widely adopted runtime.
Additionally, the kind of applications that Strut aims at are not expected to bottleneck their performance on runtime choice.
:::

:::info[Bare metal?]
Strut is not designed for bare-metal applications, a.k.a. no-`std`, or embedded systems without an OS.

Instead, Strut targets the “classical” backend applications: web/API servers, microservices, data processors, etc., where the binary size is not expected to be a constraining factor.
:::

## Shortest path to Strut

Adding Strut to a binary crate is as simple as:

1. Add Strut dependency: `cargo add strut`.
2. Prefix the `#[strut::main]` annotation to the main function, and make it `async`.

```rust title="src/main.rs"
#[strut::main]
async fn main() {
    // ...
}
```

That’s it.
From here, the next step is to understand how [`AppConfig`](docs/config) works.

:::info[What if I already use Tokio?]
It’s ok to replace the `#[tokio::main]` annotation with `#[strut::main]`.
The latter can be thought of as a wrapper for the former.

If the Tokio runtime needs to be customized, this is possible using a custom `RuntimeWiring`.
:::
